#!/bin/bash

# Get the current working directory
CWDIR=$(pwd)
sudo echo "Current working directory: $CWDIR"

# choose the interface that is connected to the console
echo "Please choose the interface that is connected to the console"
list=$(ifconfig -l)
select interface in $list
do
    echo "You have selected $interface"
    break
done

# Make sure SIP is enabled 
echo
sudo csrutil status
SIPENABLED=$(sudo csrutil status | grep "enabled" | wc -l)
if [ $SIPENABLED -ne 1 ]; then
    echo "SIP is disabled. Please enable SIP to run the exploit"
    exit 1
fi

# Give the binary permissions to run
sudo xattr -rd com.apple.quarantine $CWDIR/pppwn

# make sure your console is connected via PPPoE and ready to test connection
echo
echo "Please make sure your console is connected via PPPoE and ready to test connection"
echo "Click test connection on your console at the same time you run the exploit"

# press any key to continue
echo "Press any key to start or Ctrl+C to exit"
read -n 1 -s

# Run the exploit
echo
sudo $CWDIR/pppwn  --interface $interface --fw 1100 --stage1 $CWDIR/stage1.bin --stage2 $CWDIR/stage2.bin --auto-retry